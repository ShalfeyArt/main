<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Шалфей — Творческая мастерская</title>
    <link rel="icon" href="https://raw.githubusercontent.com/ShalfeyArt/main/refs/heads/main/shalfey.ico" type="image/x-icon">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Шрифты -->
    <link href="https://fonts.googleapis.com/css2?family=Caveat:wght@400;700&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Иконки -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getFirestore, collection, addDoc, getDocs, getDoc, doc, query, where, orderBy, setDoc, limit } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyA8roOb63vM_ZaBt11x8B1b132gQBiG29A",
            authDomain: "shalf-aad46.firebaseapp.com",
            projectId: "shalf-aad46",
            storageBucket: "shalf-aad46.firebasestorage.app",
            messagingSenderId: "131850620388",
            appId: "1:131850620388:web:1afd6733af73f96af0cbf1",
            measurementId: "G-XN22P9DJBZ"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        const provider = new GoogleAuthProvider();

        let currentUser = null;

        // --- AUTH ---
        window.googleLogin = () => {
            signInWithPopup(auth, provider)
                .then(result => showNotification(`Добро пожаловать, ${result.user.displayName}!`))
                .catch(error => console.error(error));
        };

        window.googleLogout = () => {
            signOut(auth).then(() => showNotification("Вы вышли из системы"));
        };

        onAuthStateChanged(auth, (user) => {
            currentUser = user;
            updateAuthUI(user);
            if(user) {
                checkReviewPermission(user);
                loadMyOrders(user.uid);
            } else {
                document.getElementById('my-orders-list').innerHTML = '<div class="text-center p-6 text-gray-500">Войдите через Google, чтобы видеть свои заказы.</div>';
                document.getElementById('leave-review-section').classList.add('hidden');
            }
        });

        function updateAuthUI(user) {
            const container = document.getElementById('auth-container');
            if (user) {
                container.innerHTML = `
                    <div class="flex items-center gap-3 bg-white/40 p-1 pr-4 rounded-full border border-white/50 backdrop-blur-sm">
                        <img src="${user.photoURL}" class="w-8 h-8 rounded-full border border-white">
                        <span class="text-xs font-bold text-gray-700 hidden md:block">${user.displayName.split(' ')[0]}</span>
                        <button onclick="window.googleLogout()" class="text-xs text-red-500 hover:text-red-700"><i class="fas fa-sign-out-alt"></i></button>
                    </div>
                `;
            } else {
                container.innerHTML = `
                    <button onclick="window.googleLogin()" class="flex items-center gap-2 bg-white text-gray-700 px-4 py-2 rounded-full shadow-sm hover:shadow-md transition text-xs font-bold border border-gray-100">
                        <i class="fab fa-google text-red-500"></i> <span class="hidden sm:inline">Войти</span>
                    </button>
                `;
            }
        }

        // Инициализация данных
        loadContent();
        loadAboutUs();
        loadReviews();

        // 1. ЗАГРУЗКА ТОВАРОВ
        async function loadContent() {
            const sections = ['rentals', 'workshops', 'handmade'];
            for (const section of sections) {
                const container = document.getElementById(`${section}-container`);
                if (!container) continue;
                container.innerHTML = '<div class="col-span-full text-center py-10"><i class="fas fa-spinner fa-spin text-3xl text-white"></i></div>';

                try {
                    const q = query(collection(db, "products"), where("category", "==", section));
                    const querySnapshot = await getDocs(q);
                    container.innerHTML = ''; 
                    if (querySnapshot.empty) {
                        container.innerHTML = '<div class="col-span-full text-center text-white/70 italic py-10">Пусто...</div>';
                        continue;
                    }
                    querySnapshot.forEach((doc) => {
                        container.insertAdjacentHTML('beforeend', createCardHTML(doc.data(), section));
                    });
                    setTimeout(() => { initializeCardSliders(); runAnimations(container); }, 100);
                } catch (error) { console.error(error); }
            }
        }

        // 2. ДИНАМИЧЕСКИЙ "О НАС"
        async function loadAboutUs() {
            try {
                const docSnap = await getDoc(doc(db, "content", "about_us"));
                if (docSnap.exists() && docSnap.data().text) {
                    document.getElementById('about-us-text').innerText = `"${docSnap.data().text}"`;
                }
            } catch (e) { console.error("Error loading about us", e); }
        }

        // 3. ОТЗЫВЫ (РЕАЛЬНЫЕ)
        async function loadReviews() {
            const container = document.getElementById('reviews-grid');
            try {
                const q = query(collection(db, "reviews"), orderBy("createdAt", "desc"), limit(6));
                const snap = await getDocs(q);
                
                if (snap.empty) {
                    container.innerHTML = '<div class="col-span-full text-center text-gray-500">Пока нет отзывов. Станьте первым!</div>';
                    return;
                }
                
                let html = '';
                snap.forEach(d => {
                    const r = d.data();
                    const stars = Array(5).fill(0).map((_, i) => i < r.rating ? '<i class="fas fa-star text-yellow-400 text-xs"></i>' : '<i class="far fa-star text-gray-300 text-xs"></i>').join('');
                    html += `
                        <div class="glass p-6 rounded-2xl flex flex-col gap-3 min-w-[280px] md:min-w-[320px] snap-center">
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 rounded-full bg-sage-green/20 flex items-center justify-center text-sage-dark font-bold overflow-hidden">
                                    ${r.photoURL ? `<img src="${r.photoURL}" class="w-full h-full object-cover">` : r.authorName[0]}
                                </div>
                                <div>
                                    <h4 class="font-bold text-gray-800 text-sm">${r.authorName}</h4>
                                    <div class="flex gap-0.5">${stars}</div>
                                </div>
                            </div>
                            <p class="text-gray-600 text-sm italic leading-relaxed">"${r.text}"</p>
                        </div>
                    `;
                });
                container.innerHTML = html;
            } catch (e) { console.error(e); }
        }

        // Проверка права на отзыв
        async function checkReviewPermission(user) {
            // Ищем завершенные заказы этого пользователя
            const q = query(collection(db, "orders"), where("userId", "==", user.uid), where("status", "==", "done"));
            const snap = await getDocs(q);

            if (!snap.empty) {
                // Если есть завершенные заказы, показываем форму
                document.getElementById('leave-review-section').classList.remove('hidden');
            }
        }

        window.submitReview = async (e) => {
            e.preventDefault();
            if(!currentUser) return;
            
            const form = e.target;
            const text = form.text.value;
            const rating = parseInt(form.rating.value);

            try {
                await addDoc(collection(db, "reviews"), {
                    userId: currentUser.uid,
                    authorName: currentUser.displayName,
                    photoURL: currentUser.photoURL,
                    text: text,
                    rating: rating,
                    createdAt: new Date().toISOString()
                });
                showNotification("Спасибо за ваш отзыв!");
                form.reset();
                document.getElementById('leave-review-section').classList.add('hidden'); // Скрываем после отправки
                loadReviews();
            } catch(e) {
                console.error(e);
                showNotification("Ошибка при отправке.");
            }
        }

        // 4. ЗАКАЗЫ
        window.openOrderModal = (title, type) => {
            const modal = document.getElementById('order-modal');
            const form = document.getElementById('modal-order-form');
            const titleInput = form.querySelector('input[name="costume"]');
            const modalTitle = document.getElementById('modal-product-title');

            modalTitle.innerText = title || 'Оформление заявки';
            titleInput.value = `${type}: ${title}`; // Автозаполнение
            
            modal.classList.remove('hidden');
            setTimeout(() => {
                modal.classList.remove('opacity-0');
                modal.querySelector('div[class*="transform"]').classList.remove('scale-95');
            }, 10);
        };

        window.closeOrderModal = () => {
            const modal = document.getElementById('order-modal');
            modal.classList.add('opacity-0');
            modal.querySelector('div[class*="transform"]').classList.add('scale-95');
            setTimeout(() => modal.classList.add('hidden'), 300);
        };

        window.submitOrderFromModal = async (event) => {
            event.preventDefault();
            const form = document.getElementById('modal-order-form');
            const formData = new FormData(form);
            const data = Object.fromEntries(formData.entries());
            
            data.status = 'new';
            data.createdAt = new Date().toISOString();
            data.userId = currentUser ? currentUser.uid : 'anonymous'; // Привязываем к пользователю
            
            // Если пользователь авторизован, берем его данные
            if(currentUser && !data.name) data.name = currentUser.displayName;

            const btn = form.querySelector('button[type="submit"]');
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
            btn.disabled = true;

            try {
                await addDoc(collection(db, "orders"), data);
                showNotification("Заявка отправлена!");
                form.reset();
                closeOrderModal();
                if(currentUser) loadMyOrders(currentUser.uid);
            } catch (e) {
                console.error("Ошибка: ", e);
                showNotification("Ошибка. Попробуйте позже.");
            } finally {
                btn.innerHTML = 'Отправить заявку';
                btn.disabled = false;
            }
        };

        async function loadMyOrders(uid) {
            const container = document.getElementById('my-orders-list');
            if(!container) return;
            
            // Загружаем заказы из БД (только для этого пользователя)
            const q = query(collection(db, "orders"), where("userId", "==", uid), orderBy("createdAt", "desc"));
            
            try {
                const snap = await getDocs(q);
                if (snap.empty) {
                    container.innerHTML = '<div class="glass p-6 rounded-2xl text-center text-gray-600">У вас пока нет активных заявок.</div>';
                    return;
                }
                
                let html = '';
                snap.forEach(d => {
                    const order = d.data();
                    const date = new Date(order.createdAt).toLocaleDateString('ru-RU');
                    
                    let statusBadge = 'bg-yellow-100/80 text-yellow-800';
                    let statusText = 'В обработке';
                    
                    if (order.status === 'answered') {
                        statusBadge = 'bg-blue-100/80 text-blue-800 font-bold';
                        statusText = 'Есть ответ!';
                    } else if (order.status === 'done') {
                        statusBadge = 'bg-green-100/80 text-green-800';
                        statusText = 'Завершено';
                    }

                    html += `
                    <div class="glass p-4 rounded-2xl mb-3 border border-white/40">
                        <div class="flex justify-between items-start gap-2 mb-2">
                            <h4 class="font-bold text-gray-800 text-sm">${order.costume}</h4>
                            <span class="${statusBadge} text-[10px] px-2 py-1 rounded-full uppercase font-bold">${statusText}</span>
                        </div>
                        <div class="text-xs text-gray-500 mb-2 flex items-center gap-2"><i class="far fa-clock"></i> ${date}</div>
                        ${order.adminReply ? `<div class="bg-blue-50/50 p-3 rounded-xl border border-blue-100 mt-2 text-xs text-gray-700"><b>Ответ:</b> ${order.adminReply}</div>` : ''}
                    </div>`;
                });
                container.innerHTML = html;
            } catch (e) { console.error(e); }
        }

        // --- UI UTILS ---
        function createCardHTML(item, type) {
            let images = Array.isArray(item.images) ? item.images : [item.images || ''];
            if(images.length === 0 || !images[0]) images = ['https://via.placeholder.com/400x500?text=No+Image'];

            const slidesHTML = images.map((img, index) => 
                `<div class="slide ${index === 0 ? 'active' : ''}"><img src="${img}" class="w-full h-full object-cover transition-transform duration-700 hover:scale-105"></div>`
            ).join('');

            const navHTML = images.length > 1 ? `
                <button class="slider-prev absolute left-2 top-1/2 -translate-y-1/2 bg-white/30 backdrop-blur-md p-2 rounded-full hover:bg-white/50 text-white z-10 w-8 h-8 flex items-center justify-center transition"><i class="fas fa-chevron-left"></i></button>
                <button class="slider-next absolute right-2 top-1/2 -translate-y-1/2 bg-white/30 backdrop-blur-md p-2 rounded-full hover:bg-white/50 text-white z-10 w-8 h-8 flex items-center justify-center transition"><i class="fas fa-chevron-right"></i></button>
            ` : '';

            let btnText = 'Заказать';
            let btnAction = `window.openOrderModal('${item.title}', 'Изделие')`;
            
            if (type === 'rentals') { btnText = 'Бронь'; btnAction = `window.openOrderModal('${item.title}', 'Аренда')`; }
            else if (type === 'workshops') { btnText = 'Запись'; btnAction = `window.openOrderModal('${item.title}', 'МК')`; }
            
            return `
            <div data-animate="zoom-in" class="glass rounded-3xl overflow-hidden flex flex-col h-full group hover:shadow-2xl transition-all duration-300 transform hover:-translate-y-2 border border-white/40">
                <div class="h-64 sm:h-80 relative card-slider-container overflow-hidden">
                    ${slidesHTML} ${navHTML}
                    <div class="absolute inset-0 bg-gradient-to-t from-black/20 to-transparent pointer-events-none"></div>
                </div>
                <div class="p-5 flex flex-col flex-grow relative">
                    <div class="absolute top-0 left-0 w-full h-full bg-white/40 backdrop-blur-3xl -z-10"></div>
                    <div class="flex justify-between items-start mb-2">
                        <h4 class="text-xl font-handwritten font-bold text-gray-800 leading-tight pr-2">${item.title}</h4>
                        <span class="text-sm font-bold text-sage-dark whitespace-nowrap bg-white/50 px-2 py-1 rounded-lg">${item.price}</span>
                    </div>
                    <p class="text-gray-600 text-xs mb-4 flex-grow line-clamp-3 font-light leading-relaxed">${item.description}</p>
                    <button onclick="${btnAction}" class="w-full glass-btn-sm py-3 rounded-xl text-sm font-bold text-gray-700 hover:text-white hover:bg-sage-green transition shadow-sm">${btnText}</button>
                </div>
            </div>`;
        }

        window.initializeCardSliders = initializeCardSliders;
        window.runAnimations = runAnimations;
    </script>

    <style>
        /* Glassmorphism Core */
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #e0e7ff 0%, #f3e8ff 50%, #dcfce7 100%);
            background-attachment: fixed;
            color: #4A4A4A;
        }

        .glass {
            background: rgba(255, 255, 255, 0.45);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.07);
        }

        .glass-dark {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.6);
        }

        .glass-btn-sm {
            background: rgba(255, 255, 255, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .glass-input {
            background: rgba(255, 255, 255, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(4px);
        }
        .glass-input:focus { background: rgba(255, 255, 255, 0.8); border-color: #8A9A5B; }
        .glass-input[readonly] { background: rgba(0,0,0,0.05); color: #666; cursor: not-allowed; }

        /* Typography & Colors */
        h1, h2, h3, h4, .font-handwritten { font-family: 'Caveat', cursive; }
        .text-sage-green { color: #8A9A5B; }
        .text-sage-dark { color: #5F6F3A; }
        .bg-sage-green { background-color: #8A9A5B; }
        
        /* Desktop Navigation (Dock Style) */
        .dock-icon {
            position: relative;
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        }
        .dock-icon:hover { transform: translateY(-5px) scale(1.1); color: #5F6F3A; }
        .dock-icon.active { color: #5F6F3A; }
        .dock-icon.active::after {
            content: ''; position: absolute; bottom: -8px; left: 50%; transform: translateX(-50%);
            width: 4px; height: 4px; background: #5F6F3A; border-radius: 50%;
        }
        .dock-tooltip {
            position: absolute; top: 100%; left: 50%; transform: translateX(-50%) translateY(10px);
            background: rgba(0,0,0,0.8); color: white; padding: 4px 8px; border-radius: 6px;
            font-size: 10px; opacity: 0; pointer-events: none; transition: 0.2s; white-space: nowrap; margin-top: 5px;
        }
        .dock-icon:hover .dock-tooltip { opacity: 1; transform: translateX(-50%) translateY(0); }

        /* Burger Menu Animation */
        .burger-line { transition: 0.3s; transform-origin: center; }
        .burger-open .line-1 { transform: translateY(7px) rotate(45deg); }
        .burger-open .line-2 { opacity: 0; }
        .burger-open .line-3 { transform: translateY(-7px) rotate(-45deg); }
        
        /* Mobile Menu */
        #mobile-menu {
            transform: translateY(-100%);
            transition: transform 0.5s cubic-bezier(0.77, 0, 0.175, 1);
        }
        #mobile-menu.open { transform: translateY(0); }
        .mobile-link { opacity: 0; transform: translateY(20px); transition: 0.4s; }
        #mobile-menu.open .mobile-link { opacity: 1; transform: translateY(0); }
        
        /* Utilities */
        .page-section { display: none; animation: fadeIn 0.6s ease-out; }
        .page-section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Sliders */
        .card-slider-container .slide { position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0; transition: opacity 0.5s ease-in-out; }
        .card-slider-container .slide.active { opacity: 1; }
        
        /* Scroll Animation */
        [data-animate] { opacity: 0; transition: 0.8s cubic-bezier(0.4, 0, 0.2, 1); }
        .is-visible { opacity: 1; transform: none !important; }
        [data-animate="fade-up"] { transform: translateY(30px); }
        [data-animate="zoom-in"] { transform: scale(0.95); }

        /* Preloader */
        #preloader { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #2f3630; z-index: 9999; display: flex; justify-content: center; align-items: center; transition: opacity 0.8s ease, visibility 0.8s ease; }
        #preloader.hidden { opacity: 0; visibility: hidden; }
        #preloader-logo .sage-path { stroke-dasharray: 1500; stroke-dashoffset: 1500; animation: draw 3s ease-in-out forwards; }
        @keyframes draw { to { stroke-dashoffset: 0; } }
        
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="antialiased selection:bg-sage-green selection:text-white pb-20 md:pb-0">

    <!-- Preloader -->
    <div id="preloader">
        <svg id="preloader-logo" width="120" height="120" viewBox="0 0 200 200">
            <path class="sage-path" d="M100 180 V 50 M100 130 C75 125 75 155 100 150 M100 130 C125 125 125 155 100 150 M100 100 C80 95 80 120 100 115 M100 100 C120 95 120 120 100 115 M100 75 C90 70 90 90 100 85 M100 75 C110 70 110 90 100 85" fill="none" stroke="#8A9A5B" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
    </div>

    <!-- Header -->
    <header class="fixed top-0 w-full z-50 glass-dark transition-all duration-300">
        <div class="container mx-auto px-4 py-2 flex justify-between items-center h-16">
            <!-- Logo -->
            <a href="#" class="flex items-center gap-2 group z-50 relative" onclick="showPage('home')">
                <div class="h-9 w-9 rounded-full bg-white flex items-center justify-center shadow-md overflow-hidden border border-white/50">
                    <img src="https://raw.githubusercontent.com/XtraDamage/Tonimage-/main/2499.jpg" class="h-full w-full object-cover">
                </div>
                <span class="text-2xl font-handwritten text-sage-green font-bold">Шалфей</span>
            </a>
            
            <!-- Desktop Nav (Dock) -->
            <nav class="hidden lg:flex items-center gap-8 px-8 py-3 bg-white/60 backdrop-blur-xl rounded-full border border-white/40 shadow-sm absolute left-1/2 -translate-x-1/2">
                <button class="dock-icon text-gray-500 hover:text-sage-green active" onclick="showPage('home')">
                    <i class="fas fa-home text-xl"></i>
                    <span class="dock-tooltip">Главная</span>
                </button>
                <button class="dock-icon text-gray-500 hover:text-sage-green" onclick="showPage('rentals')">
                    <i class="fas fa-tshirt text-xl"></i>
                    <span class="dock-tooltip">Аренда</span>
                </button>
                <button class="dock-icon text-gray-500 hover:text-sage-green" onclick="showPage('workshops')">
                    <i class="fas fa-paint-brush text-xl"></i>
                    <span class="dock-tooltip">Мастер-классы</span>
                </button>
                <button class="dock-icon text-gray-500 hover:text-sage-green" onclick="showPage('handmade')">
                    <i class="fas fa-gem text-xl"></i>
                    <span class="dock-tooltip">Изделия</span>
                </button>
                <button class="dock-icon text-gray-500 hover:text-sage-green" onclick="showPage('my-orders')">
                    <i class="fas fa-heart text-xl"></i>
                    <span class="dock-tooltip">Мое</span>
                </button>
                <button class="dock-icon text-gray-500 hover:text-sage-green" onclick="showPage('contacts')">
                    <i class="fas fa-envelope text-xl"></i>
                    <span class="dock-tooltip">Контакты</span>
                </button>
            </nav>

            <!-- Auth & Burger -->
            <div class="flex items-center gap-3 z-50 relative">
                <div id="auth-container">
                    <!-- Кнопка входа инжектится через JS -->
                </div>
                
                <button id="burger-btn" class="lg:hidden w-10 h-10 flex flex-col justify-center items-center gap-1.5 focus:outline-none">
                    <span class="burger-line line-1 w-6 h-0.5 bg-gray-700 rounded-full"></span>
                    <span class="burger-line line-2 w-6 h-0.5 bg-gray-700 rounded-full"></span>
                    <span class="burger-line line-3 w-6 h-0.5 bg-gray-700 rounded-full"></span>
                </button>
            </div>
        </div>

        <!-- Mobile Fullscreen Menu -->
        <div id="mobile-menu" class="fixed inset-0 bg-white/95 backdrop-blur-xl z-40 flex flex-col items-center justify-center space-y-6 pt-16 lg:hidden">
            <a href="#" class="mobile-link text-3xl font-handwritten text-gray-800 hover:text-sage-green" onclick="showPage('home'); toggleMenu()">Главная</a>
            <a href="#" class="mobile-link text-3xl font-handwritten text-gray-800 hover:text-sage-green" onclick="showPage('rentals'); toggleMenu()">Аренда</a>
            <a href="#" class="mobile-link text-3xl font-handwritten text-gray-800 hover:text-sage-green" onclick="showPage('workshops'); toggleMenu()">Мастер-классы</a>
            <a href="#" class="mobile-link text-3xl font-handwritten text-gray-800 hover:text-sage-green" onclick="showPage('handmade'); toggleMenu()">Изделия</a>
            <a href="#" class="mobile-link text-3xl font-handwritten text-gray-800 hover:text-sage-green" onclick="showPage('my-orders'); toggleMenu()">Мои заказы</a>
            <a href="#" class="mobile-link text-3xl font-handwritten text-gray-800 hover:text-sage-green" onclick="showPage('contacts'); toggleMenu()">Контакты</a>
        </div>
    </header>

    <main class="container mx-auto px-4 py-20 min-h-screen">

        <!-- Home -->
        <section id="home" class="page-section active">
            <div class="text-center mb-12 animate-fade-in pt-10">
                <h1 class="text-5xl md:text-7xl font-bold text-gray-800 mb-4 font-handwritten drop-shadow-sm"><span class="text-sage-green">Душа</span> в деталях</h1>
                <p class="text-lg text-gray-600 max-w-xl mx-auto leading-relaxed font-light">Уютная мастерская, где создаются истории.</p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-16">
                <div onclick="showPage('rentals')" class="h-64 rounded-3xl bg-[url('https://raw.githubusercontent.com/XtraDamage/Tonimage-/refs/heads/main/kostum%20krasny%20plasch%20eshe%20photo.jpg')] bg-cover bg-center relative group overflow-hidden cursor-pointer shadow-lg">
                    <div class="absolute inset-0 bg-black/30 group-hover:bg-black/40 transition flex items-center justify-center">
                        <span class="text-white font-handwritten text-4xl font-bold">Аренда</span>
                    </div>
                </div>
                <div onclick="showPage('workshops')" class="h-64 rounded-3xl bg-[url('https://raw.githubusercontent.com/XtraDamage/Tonimage-/main/Shkatulka%20samodel%20kak%20iz%20medi%20s%20masterclassa.jpg')] bg-cover bg-center relative group overflow-hidden cursor-pointer shadow-lg">
                    <div class="absolute inset-0 bg-black/30 group-hover:bg-black/40 transition flex items-center justify-center">
                        <span class="text-white font-handwritten text-4xl font-bold">МК</span>
                    </div>
                </div>
                <div onclick="showPage('handmade')" class="h-64 rounded-3xl bg-[url('https://raw.githubusercontent.com/XtraDamage/Tonimage-/main/kluchnitsa%20dlya%20kluchey%20vvide%20domikov.jpg')] bg-cover bg-center relative group overflow-hidden cursor-pointer shadow-lg">
                    <div class="absolute inset-0 bg-black/30 group-hover:bg-black/40 transition flex items-center justify-center">
                        <span class="text-white font-handwritten text-4xl font-bold">Изделия</span>
                    </div>
                </div>
            </div>

            <!-- About Us (Dynamic) -->
            <div class="glass p-8 rounded-3xl text-center shadow-sm mb-12" data-animate="fade-up">
                 <h2 class="text-3xl font-handwritten text-sage-dark mb-4">О нас</h2>
                 <p id="about-us-text" class="text-lg italic text-gray-600 max-w-3xl mx-auto">"Мы создаем магию..."</p>
            </div>

            <!-- Reviews -->
            <div class="mb-12" data-animate="fade-up">
                <h2 class="text-center text-4xl font-handwritten text-gray-800 mb-6">Отзывы гостей</h2>
                <div id="reviews-grid" class="flex overflow-x-auto gap-4 pb-6 px-2 snap-x no-scrollbar">
                    <!-- Загружаются через JS -->
                </div>
                
                <!-- Hidden Review Form -->
                <div id="leave-review-section" class="hidden max-w-md mx-auto mt-6 glass p-6 rounded-2xl animate-fade-in border-2 border-sage-green/30">
                    <h4 class="text-xl font-handwritten font-bold mb-3 text-center">Оставьте ваш отзыв</h4>
                    <p class="text-xs text-center text-gray-500 mb-4">Доступно, так как у вас есть завершенный заказ.</p>
                    <form onsubmit="window.submitReview(event)" class="space-y-3">
                        <textarea name="text" rows="3" required placeholder="Напишите пару теплых слов..." class="w-full glass-input p-3 rounded-xl outline-none text-sm"></textarea>
                        <div class="flex justify-center gap-2 text-2xl text-yellow-400 py-2">
                             <select name="rating" class="bg-transparent text-gray-700 text-sm border p-1 rounded">
                                 <option value="5">5 Звезд</option>
                                 <option value="4">4 Звезды</option>
                                 <option value="3">3 Звезды</option>
                             </select>
                        </div>
                        <button type="submit" class="w-full bg-sage-green text-white py-2 rounded-xl font-bold text-sm">Отправить</button>
                    </form>
                </div>
            </div>
        </section>

        <!-- Dynamic Sections -->
        <section id="rentals" class="page-section">
            <h2 class="text-center text-5xl font-handwritten text-sage-dark mb-8">Аренда</h2>
            <div id="rentals-container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6"></div>
        </section>

        <section id="workshops" class="page-section">
            <h2 class="text-center text-5xl font-handwritten text-sage-dark mb-8">Мастер-классы</h2>
            <div id="workshops-container" class="grid grid-cols-1 md:grid-cols-2 gap-6"></div>
        </section>

        <section id="handmade" class="page-section">
            <h2 class="text-center text-5xl font-handwritten text-sage-dark mb-8">Ручная работа</h2>
            <div id="handmade-container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6"></div>
        </section>

        <!-- My Orders -->
        <section id="my-orders" class="page-section">
            <h2 class="text-center text-5xl font-handwritten text-sage-dark mb-8">Личный кабинет</h2>
            <div id="my-orders-list" class="max-w-xl mx-auto space-y-4"></div>
        </section>

        <!-- Contacts -->
        <section id="contacts" class="page-section">
            <div class="glass p-8 rounded-3xl max-w-2xl mx-auto text-center">
                <h2 class="text-4xl font-handwritten text-sage-dark mb-6">Контакты</h2>
                <div class="flex flex-col gap-4 text-lg text-gray-700 mb-8">
                    <a href="tel:+79203226263"><i class="fas fa-phone mr-2 text-sage-green"></i> +7 (920) 322-62-63</a>
                    <div class="flex justify-center gap-6 text-3xl text-gray-400">
                        <a href="#" class="hover:text-green-500 transition"><i class="fab fa-whatsapp"></i></a>
                        <a href="#" class="hover:text-blue-500 transition"><i class="fab fa-telegram"></i></a>
                        <a href="#" class="hover:text-blue-700 transition"><i class="fab fa-vk"></i></a>
                    </div>
                </div>
                <form class="space-y-3 text-left" onsubmit="window.openOrderModal('Вопрос', 'Сообщение'); return false;">
                    <input class="w-full glass-input p-3 rounded-xl" placeholder="Ваше имя">
                    <textarea class="w-full glass-input p-3 rounded-xl" placeholder="Сообщение..."></textarea>
                    <button class="w-full bg-sage-green text-white py-3 rounded-xl font-bold">Написать</button>
                </form>
            </div>
        </section>
    </main>

    <!-- ORDER MODAL (Auto-filled & Readonly) -->
    <div id="order-modal" class="fixed inset-0 z-[100] hidden opacity-0 transition-opacity duration-300 flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-black/60 backdrop-blur-sm" onclick="closeOrderModal()"></div>
        <div class="glass bg-white/90 w-full max-w-md p-6 rounded-3xl shadow-2xl relative transform scale-95 transition-all duration-300">
            <button onclick="closeOrderModal()" class="absolute top-4 right-4 text-gray-400"><i class="fas fa-times text-xl"></i></button>
            
            <h3 class="text-2xl font-handwritten font-bold text-center mb-1">Оформление</h3>
            <p id="modal-product-title" class="text-center text-sage-dark font-medium text-sm mb-6">Товар</p>

            <form id="modal-order-form" onsubmit="submitOrderFromModal(event)" class="space-y-3">
                <!-- READONLY FIELD -->
                <div>
                    <label class="text-xs text-gray-400 font-bold ml-1">Выбранный товар</label>
                    <input name="costume" readonly class="w-full glass-input p-3 rounded-xl outline-none font-bold text-gray-600">
                </div>
                
                <input name="name" placeholder="Ваше имя" class="w-full glass-input p-3 rounded-xl outline-none">
                <input name="phone" placeholder="Контакты для связи" class="w-full glass-input p-3 rounded-xl outline-none">
                <textarea name="message" rows="2" placeholder="Комментарий (дата, размер)" class="w-full glass-input p-3 rounded-xl outline-none resize-none"></textarea>
                
                <button type="submit" class="w-full bg-sage-green text-white font-bold py-3 rounded-xl shadow-lg mt-2">
                    Отправить заявку
                </button>
                <p class="text-[10px] text-center text-gray-400 mt-2">После отправки статус появится в "Моих заказах"</p>
            </form>
        </div>
    </div>

    <!-- Toast -->
    <div id="notification" class="fixed bottom-4 left-1/2 -translate-x-1/2 glass bg-black/80 text-white px-6 py-3 rounded-full shadow-2xl translate-y-32 opacity-0 transition-all duration-500 z-[110] text-sm font-medium whitespace-nowrap">
        <span id="notif-text">Уведомление</span>
    </div>

    <script>
        // UI Logic
        const pages = document.querySelectorAll('.page-section');
        const dockIcons = document.querySelectorAll('.dock-icon');
        const preloader = document.getElementById('preloader');
        const burgerBtn = document.getElementById('burger-btn');
        const mobileMenu = document.getElementById('mobile-menu');

        window.onload = () => setTimeout(() => preloader.classList.add('hidden'), 1000);

        function showPage(pageId) {
            pages.forEach(p => p.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
            
            // Update Dock
            dockIcons.forEach(icon => {
                icon.classList.remove('active');
                if(icon.getAttribute('onclick').includes(pageId)) icon.classList.add('active');
            });

            window.scrollTo({ top: 0, behavior: 'smooth' });
            
            const container = document.getElementById(pageId);
            runAnimations(container);
        }

        // Burger Animation
        function toggleMenu() {
            burgerBtn.classList.toggle('burger-open');
            mobileMenu.classList.toggle('open');
            
            // Stagger links
            const links = document.querySelectorAll('.mobile-link');
            links.forEach((link, idx) => {
                link.style.transitionDelay = mobileMenu.classList.contains('open') ? `${idx * 0.1}s` : '0s';
            });
        }
        burgerBtn.addEventListener('click', toggleMenu);

        // Animations Logic (Reuse)
        function initializeCardSliders() {
            document.querySelectorAll('.card-slider-container').forEach(container => {
                if(container.dataset.init) return;
                container.dataset.init = true;
                const slides = container.querySelectorAll('.slide');
                if(slides.length < 2) return; 
                let current = 0;
                const nextBtn = container.querySelector('.slider-next');
                const prevBtn = container.querySelector('.slider-prev');
                const show = (idx) => {
                    slides.forEach(s => s.classList.remove('active'));
                    current = (idx + slides.length) % slides.length;
                    slides[current].classList.add('active');
                };
                if(nextBtn) nextBtn.onclick = (e) => { e.stopPropagation(); show(current + 1); };
                if(prevBtn) prevBtn.onclick = (e) => { e.stopPropagation(); show(current - 1); };
            });
        }

        function runAnimations(container) {
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) entry.target.classList.add('is-visible');
                });
            }, { threshold: 0.1 });
            container.querySelectorAll('[data-animate]').forEach(el => observer.observe(el));
        }

        function showNotification(msg) {
            const el = document.getElementById('notification');
            document.getElementById('notif-text').innerText = msg;
            el.classList.remove('translate-y-32', 'opacity-0');
            setTimeout(() => el.classList.add('translate-y-32', 'opacity-0'), 3000);
        }
    </script>
</body>
</html>
