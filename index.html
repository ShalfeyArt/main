<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Шалфей — Творческая мастерская</title>
    <link rel="icon" href="https://raw.githubusercontent.com/ShalfeyArt/main/refs/heads/main/shalfey.ico" type="image/x-icon">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        sage: {
                            light: '#B2C18E',
                            DEFAULT: '#8A9A5B',
                            dark: '#5F6F3A'
                        }
                    },
                    fontFamily: {
                        handwritten: ['Caveat', 'cursive'],
                        sans: ['Inter', 'sans-serif']
                    }
                }
            }
        }
    </script>
    
    <!-- Fonts & Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Caveat:wght@400;700&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <style>
        /* Base Styles */
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%);
            color: #1f2937;
            -webkit-tap-highlight-color: transparent;
        }

        /* Glassmorphism */
        .glass {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.8);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
        }

        .glass-dark {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border-bottom: 1px solid rgba(0,0,0,0.05);
        }

        .glass-input {
            background: rgba(255, 255, 255, 0.5);
            border: 1px solid rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }
        .glass-input:focus {
            background: #fff;
            border-color: #8A9A5B;
            box-shadow: 0 0 0 2px rgba(138, 154, 91, 0.2);
        }

        /* Navigation Dock */
        .dock-icon {
            position: relative;
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        }
        .dock-icon:hover { transform: translateY(-3px); color: #5F6F3A; }
        .dock-icon.active { color: #5F6F3A; }
        .dock-icon.active::after {
            content: ''; position: absolute; bottom: -6px; left: 50%; transform: translateX(-50%);
            width: 4px; height: 4px; background: #5F6F3A; border-radius: 50%;
        }

        /* Mobile Menu */
        #mobile-menu {
            transform: translateY(-100%);
            transition: transform 0.4s cubic-bezier(0.16, 1, 0.3, 1);
        }
        #mobile-menu.open { transform: translateY(0); }
        
        .mobile-item {
            opacity: 0;
            transform: translateY(20px);
            transition: 0.3s ease-out;
        }
        #mobile-menu.open .mobile-item {
            opacity: 1;
            transform: translateY(0);
        }

        /* Burger Animation */
        .burger-line { transition: 0.3s; transform-origin: center; }
        .burger-open .line-1 { transform: translateY(7px) rotate(45deg); }
        .burger-open .line-2 { opacity: 0; }
        .burger-open .line-3 { transform: translateY(-7px) rotate(-45deg); }

        /* Animations */
        .page-section { display: none; animation: fadeIn 0.4s ease-out forwards; }
        .page-section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Slider */
        .slide { opacity: 0; transition: opacity 0.5s ease-in-out; position: absolute; inset: 0; pointer-events: none; }
        .slide.active { opacity: 1; pointer-events: auto; }

        /* Scrollbar */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        /* Preloader */
        #preloader { position: fixed; inset: 0; background: #fff; z-index: 9999; display: flex; justify-content: center; align-items: center; transition: opacity 0.5s; }
        .sage-loader { width: 48px; height: 48px; border: 3px solid #e5e7eb; border-top-color: #8A9A5B; border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
    </style>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getFirestore, collection, addDoc, getDocs, getDoc, doc, query, where, orderBy, limit } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyA8roOb63vM_ZaBt11x8B1b132gQBiG29A",
            authDomain: "shalf-aad46.firebaseapp.com",
            projectId: "shalf-aad46",
            storageBucket: "shalf-aad46.firebasestorage.app",
            messagingSenderId: "131850620388",
            appId: "1:131850620388:web:1afd6733af73f96af0cbf1",
            measurementId: "G-XN22P9DJBZ"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        const provider = new GoogleAuthProvider();

        let currentUser = null;

        // --- AUTH ---
        window.googleLogin = () => {
            signInWithPopup(auth, provider)
                .then(result => showToast(`Привет, ${result.user.displayName}!`))
                .catch(error => console.error(error));
        };

        window.googleLogout = () => {
            signOut(auth).then(() => showToast("Вы вышли из системы"));
        };

        onAuthStateChanged(auth, (user) => {
            currentUser = user;
            updateAuthUI(user);
            if(user) {
                checkReviewPermission(user);
                loadMyOrders(user.uid);
            } else {
                document.getElementById('my-orders-list').innerHTML = `
                    <div class="glass p-8 rounded-2xl text-center">
                        <i class="fas fa-lock text-sage text-3xl mb-3"></i>
                        <p class="text-gray-500 mb-4">Войдите, чтобы видеть свои заказы</p>
                        <button onclick="window.googleLogin()" class="bg-sage text-white px-6 py-2 rounded-xl font-bold text-sm hover:opacity-90">Войти через Google</button>
                    </div>
                `;
                document.getElementById('leave-review-section').classList.add('hidden');
            }
        });

        function updateAuthUI(user) {
            const container = document.getElementById('auth-container');
            const mobileAuth = document.getElementById('mobile-auth-container');
            
            if (user) {
                const html = `
                    <div class="flex items-center gap-2 bg-white p-1 pr-3 rounded-full border shadow-sm cursor-pointer hover:bg-gray-50 transition" onclick="showPage('my-orders')">
                        <img src="${user.photoURL}" class="w-8 h-8 rounded-full border border-gray-200">
                        <span class="text-xs font-bold text-gray-700 hidden md:block">${user.displayName.split(' ')[0]}</span>
                    </div>
                `;
                container.innerHTML = html;
                // Add logout to mobile menu specifically
                mobileAuth.innerHTML = `
                    <div class="flex items-center gap-3 p-4 bg-gray-50 rounded-xl mb-4">
                        <img src="${user.photoURL}" class="w-10 h-10 rounded-full">
                        <div class="flex-1">
                            <div class="font-bold text-sm">${user.displayName}</div>
                            <div class="text-xs text-gray-500">Пользователь</div>
                        </div>
                        <button onclick="window.googleLogout()" class="text-red-500"><i class="fas fa-sign-out-alt"></i></button>
                    </div>
                `;
            } else {
                const btn = `
                    <button onclick="window.googleLogin()" class="flex items-center gap-2 bg-white text-gray-800 px-4 py-2 rounded-full shadow-sm hover:shadow-md transition text-xs font-bold border border-gray-100">
                        <i class="fab fa-google text-red-500"></i> <span class="hidden sm:inline">Войти</span>
                    </button>
                `;
                container.innerHTML = btn;
                mobileAuth.innerHTML = `
                    <button onclick="window.googleLogin(); toggleMenu()" class="w-full bg-white border border-gray-200 text-gray-800 p-4 rounded-xl font-bold flex items-center justify-center gap-2 mb-4 shadow-sm">
                        <i class="fab fa-google text-red-500"></i> Войти через Google
                    </button>
                `;
            }
        }

        // --- APP INIT ---
        window.addEventListener('load', async () => {
            // Fix loading bug: Wait for data before hiding preloader
            try {
                await Promise.all([
                    loadContent(),
                    loadReviews(),
                    loadAboutUs()
                ]);
            } catch (e) { console.error("Loading error:", e); }
            finally {
                const preloader = document.getElementById('preloader');
                preloader.style.opacity = '0';
                setTimeout(() => preloader.remove(), 500);
            }
        });

        // 1. DATA LOADING
        async function loadContent() {
            const sections = ['rentals', 'workshops', 'handmade'];
            for (const section of sections) {
                const container = document.getElementById(`${section}-container`);
                if (!container) continue;

                try {
                    const q = query(collection(db, "products"), where("category", "==", section));
                    const querySnapshot = await getDocs(q);
                    container.innerHTML = ''; 
                    if (querySnapshot.empty) {
                        container.innerHTML = '<div class="col-span-full text-center text-gray-400 italic py-10">В этом разделе пока пусто</div>';
                        continue;
                    }
                    querySnapshot.forEach((doc) => {
                        container.insertAdjacentHTML('beforeend', createCardHTML(doc.data(), section));
                    });
                    initializeSliders(container);
                } catch (error) { console.error(error); }
            }
        }

        async function loadAboutUs() {
            try {
                const docSnap = await getDoc(doc(db, "content", "about_us"));
                if (docSnap.exists() && docSnap.data().text) {
                    document.getElementById('about-us-text').innerText = `"${docSnap.data().text}"`;
                }
            } catch (e) { console.error(e); }
        }

        async function loadReviews() {
            const container = document.getElementById('reviews-grid');
            try {
                const q = query(collection(db, "reviews"), orderBy("createdAt", "desc"), limit(10));
                const snap = await getDocs(q);
                
                if (snap.empty) {
                    container.innerHTML = '<div class="w-full text-center text-gray-400 py-4">Отзывов пока нет. Будьте первым!</div>';
                    return;
                }
                
                let html = '';
                snap.forEach(d => {
                    const r = d.data();
                    const stars = Array(5).fill(0).map((_, i) => i < r.rating ? '<i class="fas fa-star text-yellow-400 text-[10px]"></i>' : '<i class="far fa-star text-gray-300 text-[10px]"></i>').join('');
                    html += `
                        <div class="bg-white p-5 rounded-xl border shadow-sm min-w-[280px] md:min-w-[320px] snap-center flex flex-col gap-3">
                            <div class="flex items-center gap-3">
                                <div class="w-8 h-8 rounded-full bg-sage-light/20 overflow-hidden">
                                    ${r.photoURL ? `<img src="${r.photoURL}" class="w-full h-full object-cover">` : '<div class="w-full h-full flex items-center justify-center text-sage"><i class="fas fa-user"></i></div>'}
                                </div>
                                <div>
                                    <h4 class="font-bold text-gray-800 text-sm leading-tight">${r.authorName}</h4>
                                    <div class="flex gap-0.5 mt-0.5">${stars}</div>
                                </div>
                            </div>
                            <p class="text-gray-600 text-sm italic leading-relaxed">"${r.text}"</p>
                        </div>
                    `;
                });
                container.innerHTML = html;
            } catch (e) { console.error(e); }
        }

        async function checkReviewPermission(user) {
            // Check if user has at least one completed order
            const q = query(collection(db, "orders"), where("userId", "==", user.uid), where("status", "==", "done"));
            const snap = await getDocs(q);
            if (!snap.empty) {
                document.getElementById('leave-review-section').classList.remove('hidden');
            }
        }

        window.submitReview = async (e) => {
            e.preventDefault();
            if(!currentUser) return;
            
            const form = e.target;
            const btn = form.querySelector('button');
            const originalText = btn.innerText;
            btn.disabled = true; btn.innerText = 'Отправка...';

            try {
                await addDoc(collection(db, "reviews"), {
                    userId: currentUser.uid,
                    authorName: currentUser.displayName,
                    photoURL: currentUser.photoURL,
                    text: form.text.value,
                    rating: parseInt(form.rating.value),
                    createdAt: new Date().toISOString()
                });
                showToast("Отзыв опубликован!");
                form.reset();
                document.getElementById('leave-review-section').classList.add('hidden');
                loadReviews();
            } catch(e) {
                console.error(e);
                showToast("Ошибка при отправке");
            } finally {
                btn.disabled = false; btn.innerText = originalText;
            }
        }

        // --- ORDER LOGIC ---
        window.openOrderModal = (title, type) => {
            const modal = document.getElementById('order-modal');
            const titleInput = document.getElementById('modal-costume');
            const modalTitle = document.getElementById('modal-product-title');

            modalTitle.innerText = title;
            titleInput.value = `${type}: ${title}`;
            
            // Auto-fill user data if available
            if(currentUser) {
                document.getElementById('modal-name').value = currentUser.displayName || '';
            }

            modal.classList.remove('hidden');
            // Small delay for animation
            setTimeout(() => {
                modal.classList.remove('opacity-0');
                modal.querySelector('div').classList.remove('scale-95');
                modal.querySelector('div').classList.add('scale-100');
            }, 10);
        };

        window.closeOrderModal = () => {
            const modal = document.getElementById('order-modal');
            modal.classList.add('opacity-0');
            modal.querySelector('div').classList.remove('scale-100');
            modal.querySelector('div').classList.add('scale-95');
            setTimeout(() => modal.classList.add('hidden'), 300);
        };

        window.submitOrder = async (e) => {
            e.preventDefault();
            const form = e.target;
            const btn = form.querySelector('button[type="submit"]');
            
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
            btn.disabled = true;

            const data = {
                costume: form.costume.value,
                name: form.name.value,
                phone: form.phone.value,
                message: form.message.value,
                status: 'new',
                createdAt: new Date().toISOString(),
                userId: currentUser ? currentUser.uid : 'anonymous'
            };

            try {
                await addDoc(collection(db, "orders"), data);
                showToast("Заявка успешно отправлена!");
                closeOrderModal();
                form.reset();
                if(currentUser) loadMyOrders(currentUser.uid);
            } catch (e) {
                showToast("Ошибка отправки. Попробуйте позже.");
            } finally {
                btn.innerHTML = 'Отправить заявку';
                btn.disabled = false;
            }
        };

        async function loadMyOrders(uid) {
            const container = document.getElementById('my-orders-list');
            const q = query(collection(db, "orders"), where("userId", "==", uid), orderBy("createdAt", "desc"));
            
            try {
                const snap = await getDocs(q);
                if (snap.empty) {
                    container.innerHTML = '<div class="text-center text-gray-500 py-8">У вас нет активных заявок</div>';
                    return;
                }
                
                let html = '';
                snap.forEach(d => {
                    const o = d.data();
                    const date = new Date(o.createdAt).toLocaleDateString('ru-RU');
                    
                    let statusClass = 'bg-yellow-100 text-yellow-700';
                    let statusText = 'В обработке';
                    if (o.status === 'answered') { statusClass = 'bg-blue-100 text-blue-700'; statusText = 'Есть ответ'; }
                    if (o.status === 'done') { statusClass = 'bg-green-100 text-green-700'; statusText = 'Завершено'; }

                    html += `
                        <div class="bg-white p-4 rounded-xl border border-gray-100 shadow-sm">
                            <div class="flex justify-between items-start mb-2">
                                <h4 class="font-bold text-gray-800 text-sm">${o.costume}</h4>
                                <span class="px-2 py-0.5 rounded text-[10px] font-bold uppercase ${statusClass}">${statusText}</span>
                            </div>
                            <div class="text-xs text-gray-400 mb-3"><i class="far fa-clock mr-1"></i> ${date}</div>
                            ${o.adminReply ? `
                                <div class="bg-gray-50 p-3 rounded-lg text-sm text-gray-700 border-l-2 border-sage">
                                    <span class="font-bold text-xs text-sage block mb-1">Ответ администратора:</span>
                                    ${o.adminReply}
                                </div>
                            ` : ''}
                        </div>
                    `;
                });
                container.innerHTML = html;
            } catch (e) { console.error(e); }
        }

        // --- UTILS ---
        function createCardHTML(item, type) {
            let images = Array.isArray(item.images) ? item.images : [item.images || ''];
            if(!images[0]) images = ['https://via.placeholder.com/400x400?text=No+Image'];

            const slides = images.map((img, i) => 
                `<img src="${img}" class="slide ${i===0?'active':''} w-full h-full object-cover transition-transform duration-700 hover:scale-110">`
            ).join('');

            const nav = images.length > 1 ? `
                <button class="slider-prev absolute left-2 top-1/2 -translate-y-1/2 w-8 h-8 bg-white/80 rounded-full flex items-center justify-center shadow text-gray-700 hover:bg-white transition z-10"><i class="fas fa-chevron-left text-xs"></i></button>
                <button class="slider-next absolute right-2 top-1/2 -translate-y-1/2 w-8 h-8 bg-white/80 rounded-full flex items-center justify-center shadow text-gray-700 hover:bg-white transition z-10"><i class="fas fa-chevron-right text-xs"></i></button>
            ` : '';

            let btnText = 'Заказать';
            let catName = 'Изделие';
            if(type === 'rentals') { btnText = 'Забронировать'; catName = 'Аренда'; }
            if(type === 'workshops') { btnText = 'Записаться'; catName = 'МК'; }

            return `
                <div class="glass rounded-2xl overflow-hidden flex flex-col group hover:shadow-lg transition duration-300">
                    <div class="relative h-64 overflow-hidden slider-container">
                        ${slides} ${nav}
                    </div>
                    <div class="p-4 flex flex-col flex-1">
                        <div class="flex justify-between items-start mb-2">
                            <h3 class="font-bold text-gray-800 leading-tight">${item.title}</h3>
                            <span class="bg-sage/10 text-sage-dark px-2 py-1 rounded text-xs font-bold whitespace-nowrap">${item.price}</span>
                        </div>
                        <p class="text-sm text-gray-500 line-clamp-2 mb-4 flex-1">${item.description}</p>
                        <button onclick="window.openOrderModal('${item.title}', '${catName}')" class="w-full bg-white border border-sage text-sage-dark py-2.5 rounded-xl text-sm font-bold hover:bg-sage hover:text-white transition shadow-sm">
                            ${btnText}
                        </button>
                    </div>
                </div>
            `;
        }

        function initializeSliders(root) {
            root.querySelectorAll('.slider-container').forEach(el => {
                const slides = el.querySelectorAll('.slide');
                if(slides.length < 2) return;
                let cur = 0;
                const show = (idx) => {
                    slides[cur].classList.remove('active');
                    cur = (idx + slides.length) % slides.length;
                    slides[cur].classList.add('active');
                };
                el.querySelector('.slider-next').onclick = () => show(cur + 1);
                el.querySelector('.slider-prev').onclick = () => show(cur - 1);
            });
        }

        window.showToast = (msg) => {
            const t = document.getElementById('toast');
            t.innerText = msg;
            t.classList.remove('translate-y-20', 'opacity-0');
            setTimeout(() => t.classList.add('translate-y-20', 'opacity-0'), 3000);
        }
    </script>
</head>
<body class="pb-24 lg:pb-0">

    <!-- PRELOADER -->
    <div id="preloader">
        <div class="sage-loader"></div>
    </div>

    <!-- HEADER -->
    <header class="fixed top-0 w-full z-50 glass-dark">
        <div class="container mx-auto px-4 h-16 flex items-center justify-between">
            <button onclick="showPage('home')" class="flex items-center gap-2 group">
                <div class="w-8 h-8 rounded-full bg-sage overflow-hidden shadow-sm">
                     <img src="https://raw.githubusercontent.com/XtraDamage/Tonimage-/main/2499.jpg" class="w-full h-full object-cover">
                </div>
                <span class="font-handwritten text-2xl font-bold text-sage-dark group-hover:text-sage transition">Шалфей</span>
            </button>

            <!-- Desktop Nav -->
            <nav class="hidden lg:flex items-center gap-8 bg-white/80 px-8 py-2 rounded-full shadow-sm border border-gray-100">
                <button onclick="showPage('home')" class="dock-icon active text-gray-500 hover:text-sage font-medium text-sm">Главная</button>
                <button onclick="showPage('rentals')" class="dock-icon text-gray-500 hover:text-sage font-medium text-sm">Аренда</button>
                <button onclick="showPage('workshops')" class="dock-icon text-gray-500 hover:text-sage font-medium text-sm">МК</button>
                <button onclick="showPage('handmade')" class="dock-icon text-gray-500 hover:text-sage font-medium text-sm">Изделия</button>
                <button onclick="showPage('contacts')" class="dock-icon text-gray-500 hover:text-sage font-medium text-sm">Контакты</button>
            </nav>

            <div class="flex items-center gap-3">
                <div id="auth-container"></div>
                <!-- Burger Button -->
                <button id="burger-btn" class="lg:hidden w-10 h-10 flex flex-col justify-center items-center gap-1.5 z-[60]" onclick="toggleMenu()">
                    <span class="burger-line line-1 w-5 h-0.5 bg-gray-800 rounded-full"></span>
                    <span class="burger-line line-2 w-5 h-0.5 bg-gray-800 rounded-full"></span>
                    <span class="burger-line line-3 w-5 h-0.5 bg-gray-800 rounded-full"></span>
                </button>
            </div>
        </div>
    </header>

    <!-- MOBILE MENU (Redesigned) -->
    <div id="mobile-menu" class="fixed inset-0 bg-white z-[55] pt-24 px-6 flex flex-col lg:hidden overflow-y-auto">
        <div id="mobile-auth-container"></div>
        
        <div class="space-y-3">
            <button onclick="showPage('home'); toggleMenu()" class="mobile-item w-full flex items-center gap-4 p-4 rounded-xl bg-gray-50 border border-gray-100 shadow-sm active:scale-95 transition">
                <div class="w-10 h-10 rounded-full bg-white flex items-center justify-center text-sage shadow-sm"><i class="fas fa-home"></i></div>
                <span class="font-bold text-gray-700">Главная</span>
            </button>
            
            <button onclick="showPage('rentals'); toggleMenu()" class="mobile-item w-full flex items-center gap-4 p-4 rounded-xl bg-gray-50 border border-gray-100 shadow-sm active:scale-95 transition" style="transition-delay: 50ms">
                <div class="w-10 h-10 rounded-full bg-white flex items-center justify-center text-sage shadow-sm"><i class="fas fa-tshirt"></i></div>
                <span class="font-bold text-gray-700">Аренда</span>
            </button>
            
            <button onclick="showPage('workshops'); toggleMenu()" class="mobile-item w-full flex items-center gap-4 p-4 rounded-xl bg-gray-50 border border-gray-100 shadow-sm active:scale-95 transition" style="transition-delay: 100ms">
                <div class="w-10 h-10 rounded-full bg-white flex items-center justify-center text-sage shadow-sm"><i class="fas fa-paint-brush"></i></div>
                <span class="font-bold text-gray-700">Мастер-классы</span>
            </button>
            
            <button onclick="showPage('handmade'); toggleMenu()" class="mobile-item w-full flex items-center gap-4 p-4 rounded-xl bg-gray-50 border border-gray-100 shadow-sm active:scale-95 transition" style="transition-delay: 150ms">
                <div class="w-10 h-10 rounded-full bg-white flex items-center justify-center text-sage shadow-sm"><i class="fas fa-gem"></i></div>
                <span class="font-bold text-gray-700">Изделия</span>
            </button>
            
            <button onclick="showPage('my-orders'); toggleMenu()" class="mobile-item w-full flex items-center gap-4 p-4 rounded-xl bg-gray-50 border border-gray-100 shadow-sm active:scale-95 transition" style="transition-delay: 200ms">
                <div class="w-10 h-10 rounded-full bg-white flex items-center justify-center text-sage shadow-sm"><i class="fas fa-shopping-bag"></i></div>
                <span class="font-bold text-gray-700">Мои заказы</span>
            </button>

            <button onclick="showPage('contacts'); toggleMenu()" class="mobile-item w-full flex items-center gap-4 p-4 rounded-xl bg-gray-50 border border-gray-100 shadow-sm active:scale-95 transition" style="transition-delay: 250ms">
                <div class="w-10 h-10 rounded-full bg-white flex items-center justify-center text-sage shadow-sm"><i class="fas fa-envelope"></i></div>
                <span class="font-bold text-gray-700">Контакты</span>
            </button>
        </div>
    </div>

    <!-- MAIN CONTENT -->
    <main class="container mx-auto px-4 py-24 min-h-screen">
        
        <!-- HOME SECTION -->
        <section id="home" class="page-section active">
            <div class="text-center mb-12 animate-fade-in">
                <h1 class="text-5xl md:text-7xl font-handwritten font-bold text-gray-800 mb-4"><span class="text-sage">Творим</span> с душой</h1>
                <p class="text-gray-500 max-w-md mx-auto">Уютная мастерская костюмов, реквизита и уникальных подарков ручной работы.</p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-16">
                <div onclick="showPage('rentals')" class="cursor-pointer group relative h-64 rounded-3xl overflow-hidden shadow-lg">
                    <img src="https://raw.githubusercontent.com/XtraDamage/Tonimage-/refs/heads/main/kostum%20krasny%20plasch%20eshe%20photo.jpg" class="w-full h-full object-cover transition duration-700 group-hover:scale-110">
                    <div class="absolute inset-0 bg-black/40 flex items-center justify-center backdrop-blur-[2px] group-hover:backdrop-blur-none transition">
                        <span class="text-white font-handwritten text-4xl font-bold">Аренда</span>
                    </div>
                </div>
                <div onclick="showPage('workshops')" class="cursor-pointer group relative h-64 rounded-3xl overflow-hidden shadow-lg">
                    <img src="https://raw.githubusercontent.com/XtraDamage/Tonimage-/main/Shkatulka%20samodel%20kak%20iz%20medi%20s%20masterclassa.jpg" class="w-full h-full object-cover transition duration-700 group-hover:scale-110">
                    <div class="absolute inset-0 bg-black/40 flex items-center justify-center backdrop-blur-[2px] group-hover:backdrop-blur-none transition">
                        <span class="text-white font-handwritten text-4xl font-bold">МК</span>
                    </div>
                </div>
                <div onclick="showPage('handmade')" class="cursor-pointer group relative h-64 rounded-3xl overflow-hidden shadow-lg">
                    <img src="https://raw.githubusercontent.com/XtraDamage/Tonimage-/main/kluchnitsa%20dlya%20kluchey%20vvide%20domikov.jpg" class="w-full h-full object-cover transition duration-700 group-hover:scale-110">
                    <div class="absolute inset-0 bg-black/40 flex items-center justify-center backdrop-blur-[2px] group-hover:backdrop-blur-none transition">
                        <span class="text-white font-handwritten text-4xl font-bold">Изделия</span>
                    </div>
                </div>
            </div>

            <!-- About -->
            <div class="glass p-8 rounded-3xl text-center mb-12">
                <h2 class="text-3xl font-handwritten text-sage-dark mb-4">О нас</h2>
                <p id="about-us-text" class="text-gray-600 italic">"Мы создаем вещи, которые хранят тепло рук..."</p>
            </div>

            <!-- Reviews -->
            <div>
                <h2 class="text-center text-3xl font-handwritten text-gray-800 mb-6">Отзывы</h2>
                <div id="reviews-grid" class="flex overflow-x-auto gap-4 pb-8 px-2 snap-x no-scrollbar"></div>

                <!-- Review Form -->
                <div id="leave-review-section" class="hidden mt-8 max-w-lg mx-auto bg-white p-6 rounded-2xl shadow-lg border border-sage/20">
                    <h3 class="font-bold text-center text-gray-800 mb-2">Вам понравилось?</h3>
                    <p class="text-xs text-center text-gray-400 mb-4">Оставьте отзыв о вашей покупке или посещении</p>
                    <form onsubmit="submitReview(event)" class="flex flex-col gap-3">
                        <textarea name="text" required placeholder="Напишите ваш отзыв..." class="w-full bg-gray-50 p-4 rounded-xl text-sm border-0 focus:ring-2 focus:ring-sage focus:bg-white transition resize-none h-24"></textarea>
                        <div class="flex items-center justify-between">
                            <select name="rating" class="bg-gray-50 border-0 rounded-lg text-sm p-2 font-bold text-gray-600">
                                <option value="5">⭐⭐⭐⭐⭐ (5)</option>
                                <option value="4">⭐⭐⭐⭐ (4)</option>
                                <option value="3">⭐⭐⭐ (3)</option>
                            </select>
                            <button class="bg-sage text-white px-6 py-2 rounded-lg font-bold text-sm shadow hover:bg-sage-dark transition">Отправить</button>
                        </div>
                    </form>
                </div>
            </div>
        </section>

        <!-- SECTIONS -->
        <section id="rentals" class="page-section">
            <h2 class="text-4xl font-handwritten text-center text-gray-800 mb-8">Костюмерная</h2>
            <div id="rentals-container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6"></div>
        </section>

        <section id="workshops" class="page-section">
            <h2 class="text-4xl font-handwritten text-center text-gray-800 mb-8">Мастер-классы</h2>
            <div id="workshops-container" class="grid grid-cols-1 md:grid-cols-2 gap-6"></div>
        </section>

        <section id="handmade" class="page-section">
            <h2 class="text-4xl font-handwritten text-center text-gray-800 mb-8">Ручная работа</h2>
            <div id="handmade-container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6"></div>
        </section>

        <section id="my-orders" class="page-section">
            <h2 class="text-4xl font-handwritten text-center text-gray-800 mb-8">Мои заявки</h2>
            <div id="my-orders-list" class="max-w-xl mx-auto space-y-4"></div>
        </section>

        <section id="contacts" class="page-section">
            <div class="max-w-xl mx-auto glass p-8 rounded-3xl text-center">
                <h2 class="text-4xl font-handwritten text-gray-800 mb-6">Свяжитесь с нами</h2>
                <div class="flex flex-col gap-4 mb-8">
                    <a href="tel:+79203226263" class="text-xl font-bold text-gray-700 hover:text-sage transition">+7 (920) 322-62-63</a>
                    <div class="flex justify-center gap-6 text-3xl text-gray-400">
                        <a href="#" class="hover:text-green-500"><i class="fab fa-whatsapp"></i></a>
                        <a href="#" class="hover:text-blue-500"><i class="fab fa-telegram"></i></a>
                        <a href="#" class="hover:text-blue-700"><i class="fab fa-vk"></i></a>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <!-- ORDER MODAL -->
    <div id="order-modal" class="hidden fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/60 opacity-0 transition-opacity duration-300 backdrop-blur-sm">
        <div class="bg-white w-full max-w-md p-6 rounded-3xl shadow-2xl relative transform scale-95 transition-all duration-300">
            <button onclick="closeOrderModal()" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600"><i class="fas fa-times text-xl"></i></button>
            
            <h3 class="text-2xl font-handwritten font-bold text-center mb-1">Заявка</h3>
            <p id="modal-product-title" class="text-center text-sage text-sm font-bold mb-6 truncate px-8">Товар</p>

            <form onsubmit="submitOrder(event)" class="space-y-4">
                <div class="bg-gray-50 p-3 rounded-xl border border-gray-100">
                    <label class="text-[10px] uppercase font-bold text-gray-400 pl-1">Вы выбрали</label>
                    <input id="modal-costume" name="costume" readonly class="w-full bg-transparent font-bold text-gray-700 outline-none text-sm">
                </div>
                
                <div class="space-y-2">
                    <input id="modal-name" name="name" required placeholder="Ваше имя" class="w-full bg-gray-50 p-3 rounded-xl outline-none focus:bg-white focus:ring-2 focus:ring-sage/20 transition">
                    <input name="phone" required placeholder="Телефон / Мессенджер" class="w-full bg-gray-50 p-3 rounded-xl outline-none focus:bg-white focus:ring-2 focus:ring-sage/20 transition">
                    <textarea name="message" placeholder="Комментарий (дата, размер...)" rows="2" class="w-full bg-gray-50 p-3 rounded-xl outline-none focus:bg-white focus:ring-2 focus:ring-sage/20 transition resize-none"></textarea>
                </div>
                
                <button type="submit" class="w-full bg-sage text-white font-bold py-3.5 rounded-xl shadow-lg hover:bg-sage-dark transition transform active:scale-95">
                    Отправить
                </button>
            </form>
        </div>
    </div>

    <!-- TOAST -->
    <div id="toast" class="fixed bottom-6 left-1/2 -translate-x-1/2 bg-gray-800 text-white px-6 py-3 rounded-full shadow-2xl opacity-0 translate-y-20 transition-all duration-500 z-[110] text-sm font-medium whitespace-nowrap"></div>

    <script>
        // NAVIGATION LOGIC
        const pages = document.querySelectorAll('.page-section');
        const dockIcons = document.querySelectorAll('.dock-icon');
        const burgerBtn = document.getElementById('burger-btn');
        const mobileMenu = document.getElementById('mobile-menu');

        function showPage(id) {
            window.scrollTo({ top: 0, behavior: 'smooth' });
            
            pages.forEach(p => p.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            
            dockIcons.forEach(icon => {
                icon.classList.remove('active');
                if(icon.getAttribute('onclick').includes(id)) icon.classList.add('active');
            });
        }

        function toggleMenu() {
            burgerBtn.classList.toggle('burger-open');
            mobileMenu.classList.toggle('open');
            document.body.style.overflow = mobileMenu.classList.contains('open') ? 'hidden' : '';
        }
    </script>
</body>
</html>
